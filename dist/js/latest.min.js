function cron(){let result=$.get(site.sub_path+"api/get",{hash:site.hash});result.done((function(d){if(d.status=="ok"){if(site.latest.data!=d.data[0]){site.latest.data=d.data[0]}}else{throwalert("Ajax request failed with: "+d.message,1)}}));result.fail((function(resp){if(resp.responseText){message=JSON.parse(resp.responseText).message;status=1}else{message="Server unreachable.";status=2}throwalert("Ajax request failed with: "+message,status)}));if(site.latest.data!=null){date=new Date(site.latest.data.draw_time);now=new Date;minutes=Math.round((now.getTime()-date.getTime())/(1e3*60));if(minutes<16){site.latest.status=1}else if(minutes>15&&minutes<180){site.latest.status=2}else if(minutes>179){site.latest.status=3}else{site.latest.status=0}statusbar(site.latest.data.draw_time,site.latest.status)}else{site.latest.status=0;statusbar("",site.latest.status)}if(site.latest.status==1){valuedash(site.latest.data,1)}else{valuedash({},0)}}$("#login").submit((function(e){let display=function(msg,subject="valid"){if(subject=="invalid"){$("#hash").addClass("is-invalid");$(".input-section .feedback").addClass("invalid-feedback")}else if(subject=="valid"){$("#hash").addClass("is-valid");$(".input-section .feedback").addClass("valid-feedback")}$(".input-section .feedback").html(msg);$(".input-section .feedback").show()};let login_alert=function(msg){$(".inner-form .headline-section").after('<div class="alert alert-danger">                    <strong>Error:</strong> '+msg+"                  </div>")};e.preventDefault();if($(".inner-form .alert").length>2){$(".inner-form .alert").last().remove()}$("#submit").prop("disabled",true);let result=$.post(site.sub_path+"ajax/login",{hash:$("#hash").val()});result.done((function(d){$(".inner-form .alert").last().remove();if(d.status=="ok"&&d.data.auth=="ok"){display("Successful login","valid");window.location.href=site.sub_path+"dashboard"}else if(d.status=="ok"&&d.data.auth=="failed"){display("Unknown hash.","invalid")}else{login_alert("Request rejected.")}}));result.fail((function(){login_alert("Ajax request failed.")}));$("#submit").prop("disabled",false)}));$(".input-section input[name=login_hash]").focus((function(){$(".input-section .feedback").hide();$(".input-section .feedback").html();$(this).removeClass("is-invalid");$(this).removeClass("is-valid")}));$("#logout").click((function(e){e.preventDefault();$("#logout").prop("disabled",true);let result=$.post(site.sub_path+"ajax/logout",{});result.done((function(d){if(d.status=="ok"&&d.data.logout=="ok"){window.location.href=site.sub_path+"login"}else if(d.status=="ok"&&d.data.logout=="failed"){throwalert("Logout request failed",2)}else{throwalert("Logout request rejected",2)}}));result.fail((function(){throwalert("Logout request failed",2)}));$("#logout").prop("disabled",false)}));function statusbar(datestring="",status=0){date=new Date(datestring);now=new Date;let bar="#dashboard-head .user-section .info-tab";pill=function(bar,txt,cls){$(bar+" .status-pill").html(txt);["secondary","danger","warning","success"].forEach((function(key){$(bar+" .status-pill").removeClass("badge-"+key)}));$(bar+" .status-pill").addClass("badge-"+cls)};txt=function(bar,txt){$(bar+" .status-text").html(txt)};case_day=function(n,d){today=n.getFullYear()+n.getMonth()+n.getDate();thatday=d.getFullYear()+d.getMonth()+d.getDate();if(today==thatday){return"today"}else if(today-1==thatday){return"yesterday"}else{return"else"}};current_time=function(d){string="";if(d.getHours()<10){string="0"+d.getHours()}else{string=d.getHours()}string=string+":";if(d.getMinutes()<10){string=string+"0"+d.getMinutes()}else{string=string+d.getMinutes()}return string};minutes_ago=function(n,d){return Math.round((n.getTime()-d.getTime())/(1e3*60))};switch(status){case 0:txt(bar,"Status unknown.");pill(bar,"Unknown","secondary");break;case 1:let m=minutes_ago(now,date);txt(bar,"Last database update "+m+" minute"+(m==1?"":"s")+" ago.");pill(bar,"Up to date","success");break;case 2:txt(bar,"Last database update "+Math.round(minutes_ago(now,date)/60)+" hours ago at "+case_day(now,date)+", "+current_time(date)+".");pill(bar,"Nearly outdated","warning");break;case 3:day=case_day(now,date);if(day=="today"||day=="yesterday"){txt(bar,"Last database update "+day+" at "+current_time(date)+".")}else{txt(bar,"Last database update "+date.toLocaleDateString()+" at "+current_time(date)+".")}pill(bar,"Outdated","danger");break}}function throwalert(msg,level=0){id="a-"+Date.now();let area=".alert-area";if($(area+" .alert").length>7){$(area+" .alert").last().remove()}if(level==2){cls="danger";type="Error"}else if(level==1){cls="warning";type="Warning"}else if(level==0){cls="secondary";type="Notice"}if(msg.length>70){msg=msg.substring(0,67)+"..."}$(area).append('<div id="'+id+'" class="alert alert-dismissible alert-'+cls+'">            <button type="button" class="close">&times;</button>            <strong>'+type+":</strong> "+msg+"        </div>");$(area).find(":hidden").remove();$("#"+id).delay(6e3).fadeOut();$("#"+id+" .close").click((function(){$(this).parent().remove()}))}function valuedash(values,display=1){let container="#status-bar .value-container";if(display==1){$(container).fadeIn("fast")}else{$(container).fadeOut("fast")}$(container+" #humidity .text .parsed-value").html(values.humidity);$(container+" #temperature .text .parsed-value").html(values.temperature);$(container+" #pressure .text .parsed-value").html(values.pressure)}